---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ .Values.fs_name }}
  labels:
    {{- include "fsx-storageclass.labels" . | nindent 4 }}
  namespace: {{ .Values.namespace }}
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: {{ .Values.storageClassName }}
  resources:
    requests:
      storage: {{ .Values.storage }}

---
apiVersion: v1
kind: Pod
metadata:
  name: chmod-fsx-pod
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "fsx-storageclass.labels" . | nindent 4 }}
spec:
  containers:
  - name: ownership-change
    image: {{.Values.image_repository}}
    command: ["sh", "-c", "chown -hR +999:+65534 /data"]
    volumeMounts:
    - name: persistent-storage
      mountPath: /data
  volumes:
  - name: persistent-storage
    persistentVolumeClaim:
      claimName: {{ .Values.fs_name }}