apiVersion: v1
kind: Namespace
metadata:
  name: env
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: datamaker-landing-page
  name: landing-page
  namespace: env
spec:
  replicas: 2
  selector:
    matchLabels:
      app: datamaker-landing-page
  template:
    metadata:
      labels:
        app: datamaker-landing-page
      name: landing-page
    spec:
      restartPolicy: Always
      containers:
        - image: ${account_id}.dkr.ecr.${region}.amazonaws.com/datamaker-${env_name}-landing-page:${tag}
          env:
            - name: AWS_DEFAULT_REGION
              value: ${region}
            - name: ENV_NAME
              value: ${env_name}
            - name: USER_POOL_ID
              value: ${user_pool_id}
            - name: USER_POOL_CLIENT_ID
              value: ${user_pool_client_id}
            - name: IDENTITY_POOL_ID
              value: ${identity_pool_id}
          imagePullPolicy: Always
          name: container
          ports:
            - containerPort: 80
          resources:
            limits:
                cpu: "1.5"
                memory: "3G"
            requests:
                cpu: "1.5"
                memory: "3G"
      nodeSelector:
        team: env
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: datamaker-landing-page
  name: landing-page-public
  namespace: env
spec:
  ports:
    - port: 80
      protocol: TCP
      targetPort: 80
  selector:
    app: datamaker-landing-page
  type: LoadBalancer