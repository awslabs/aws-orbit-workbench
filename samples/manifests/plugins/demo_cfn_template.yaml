AWSTemplateFormatVersion: '2010-09-09'
Description: |
  Orbit Workbench Testing Demo Stack - ${env_name} - ${team_name}
Parameters:
  envkmskeyarn:
    Type: String
    ParameterProperty: envkmskeyarnvalue
  orbituserpool:
    Type: String
    ParameterProperty: orbituserpoolvalue
Resources:
  scratchbuckettesting:
    Type: 'AWS::S3::Bucket'
    Properties:
      AccessControl: BucketOwnerFullControl
#      BucketEncryption:
#        ServerSideEncryptionConfiguration:
#          - ServerSideEncryptionByDefault:
#              KMSMasterKeyID: !GetAtt
#                - kmskey49FBC3B3
#                - Arn
#              SSEAlgorithm: 'aws:kms'
      BucketName: !Join
        - ''
        - - orbit-testing-scratch-
          - !Ref 'AWS::AccountId'
          - '-pluginid'
      LifecycleConfiguration:
        Rules:
          - ExpirationInDays: 30
            Status: Enabled
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Env
          Value: orbit-testing
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
  lakebuckettesting:
    Type: 'AWS::S3::Bucket'
    Properties:
      AccessControl: BucketOwnerFullControl
#      BucketEncryption:
#        ServerSideEncryptionConfiguration:
#          - ServerSideEncryptionByDefault:
#              KMSMasterKeyID: !GetAtt
#                - kmskey49FBC3B3
#                - Arn
#              SSEAlgorithm: 'aws:kms'
      BucketName: !Join
        - ''
        - - orbit-testing-demo-lake-
          - !Ref 'AWS::AccountId'
          - '-pluginid'
      LifecycleConfiguration:
        Rules:
          - ExpirationInDays: 90
            Status: Enabled
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Env
          Value: orbit-testing
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
#  securedlakebucketF62B741B:
#    Type: 'AWS::S3::Bucket'
#    Properties:
#      AccessControl: BucketOwnerFullControl
#      BucketEncryption:
#        ServerSideEncryptionConfiguration:
#          - ServerSideEncryptionByDefault:
#              KMSMasterKeyID: !GetAtt
#                - kmskey49FBC3B3
#                - Arn
#              SSEAlgorithm: 'aws:kms'
#      BucketName: !Join
#        - ''
#        - - orbit-dev-env-secured-demo-lake-
#          - !Ref 'AWS::AccountId'
#          - '-3fe187'
#      LifecycleConfiguration:
#        Rules:
#          - ExpirationInDays: 90
#            Status: Enabled
#      PublicAccessBlockConfiguration:
#        BlockPublicAcls: true
#        BlockPublicPolicy: true
#        IgnorePublicAcls: true
#        RestrictPublicBuckets: true
#      Tags:
#        - Key: Env
#          Value: orbit-dev-env
#    UpdateReplacePolicy: Retain
#    DeletionPolicy: Retain
#    Metadata:
#      'aws:cdk:path': orbit-dev-env-demo/secured_lake_bucket/Resource
  LakeBucketFullAccess83731CEA:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Statement:
          - Action: 's3:*'
            Effect: Allow
            Resource:
              - !GetAtt
                - lakebuckettesting
                - Arn
              - !Join
                - ''
                - - !GetAtt
                    - lakebuckettesting
                    - Arn
                  - '*'
          - Action: 'glue:*'
            Effect: Allow
            Resource: '*'
        Version: 2012-10-17
      Description: ''
      ManagedPolicyName: orbit-testing-demo-lake-bucket-fullaccess
      Path: /
#  LakeBucketReadOnlyAccessE37861C8:
#    Type: 'AWS::IAM::ManagedPolicy'
#    Properties:
#      PolicyDocument:
#        Statement:
#          - Action:
#              - 's3:Get*'
#              - 's3:List*'
#            Effect: Allow
#            Resource:
#              - !GetAtt
#                - lakebucket778F4D47
#                - Arn
#              - !Join
#                - ''
#                - - !GetAtt
#                    - lakebucket778F4D47
#                    - Arn
#                  - '*'
#          - Action: 'glue:*'
#            Effect: Allow
#            Resource: '*'
#          - Action: 'kms:*'
#            Effect: Allow
#            Resource: !GetAtt
#              - kmskey49FBC3B3
#              - Arn
#        Version: 2012-10-17
#      Description: ''
#      ManagedPolicyName: orbit-dev-env-demo-lake-bucket-readonlyaccess
#      Path: /
#    Metadata:
#      'aws:cdk:path': orbit-dev-env-demo/LakeBucketReadOnlyAccess/Resource


#  lakecreatorgroup:
#    Type: 'AWS::Cognito::UserPoolGroup'
#    Properties:
#      UserPoolId: !Ref orbituserpool
#      Description: lake-creator users group.
#      GroupName: lake-creator
#  lakeusergroup:
#    Type: 'AWS::Cognito::UserPoolGroup'
#    Properties:
#      UserPoolId: !Ref orbituserpool
#      Description: lake-user users group.
#      GroupName: lake-user


